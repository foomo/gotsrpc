// Code generated by gotsrpc https://github.com/foomo/gotsrpc/v2 - DO NOT EDIT.

package server

import (
	io "io"
	http "net/http"
	time "time"

	gotsrpc "github.com/foomo/gotsrpc/v2"
)

const (
	ServiceGoTSRPCProxyCustomError  = "CustomError"
	ServiceGoTSRPCProxyError        = "Error"
	ServiceGoTSRPCProxyHello        = "Hello"
	ServiceGoTSRPCProxyJoinedError  = "JoinedError"
	ServiceGoTSRPCProxyPkgError     = "PkgError"
	ServiceGoTSRPCProxyWrappedError = "WrappedError"
)

type ServiceGoTSRPCProxy struct {
	EndPoint string
	service  Service
}

func NewDefaultServiceGoTSRPCProxy(service Service) *ServiceGoTSRPCProxy {
	return NewServiceGoTSRPCProxy(service, "/service")
}

func NewServiceGoTSRPCProxy(service Service, endpoint string) *ServiceGoTSRPCProxy {
	return &ServiceGoTSRPCProxy{
		EndPoint: endpoint,
		service:  service,
	}
}

// ServeHTTP exposes your service
func (p *ServiceGoTSRPCProxy) ServeHTTP(w http.ResponseWriter, r *http.Request) {
	if r.Method == http.MethodOptions {
		return
	} else if r.Method != http.MethodPost {
		gotsrpc.ErrorMethodNotAllowed(w)
		return
	}
	defer io.Copy(io.Discard, r.Body) // Drain Request Body

	funcName := gotsrpc.GetCalledFunc(r, p.EndPoint)
	callStats, _ := gotsrpc.GetStatsForRequest(r)
	callStats.Func = funcName
	callStats.Package = "github.com/foomo/gotsrpc/v2/tests/context/server"
	callStats.Service = "Service"
	switch funcName {
	case ServiceGoTSRPCProxyCustomError:
		var (
			args []any
			rets []any
		)
		var (
			arg_msg string
		)
		args = []any{&arg_msg}
		if err := gotsrpc.LoadArgs(&args, callStats, r); err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		executionStart := time.Now()
		customErrorRet := p.service.CustomError(r.Context(), arg_msg)
		callStats.Execution = time.Since(executionStart)
		rets = []any{customErrorRet}
		if err := gotsrpc.Reply(rets, callStats, r, w); err != nil {
			gotsrpc.ErrorCouldNotReply(w)
			return
		}
		gotsrpc.Monitor(w, r, args, rets, callStats)
		return
	case ServiceGoTSRPCProxyError:
		var (
			args []any
			rets []any
		)
		var (
			arg_msg string
		)
		args = []any{&arg_msg}
		if err := gotsrpc.LoadArgs(&args, callStats, r); err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		executionStart := time.Now()
		errorRet := p.service.Error(r.Context(), arg_msg)
		callStats.Execution = time.Since(executionStart)
		rets = []any{errorRet}
		if err := gotsrpc.Reply(rets, callStats, r, w); err != nil {
			gotsrpc.ErrorCouldNotReply(w)
			return
		}
		gotsrpc.Monitor(w, r, args, rets, callStats)
		return
	case ServiceGoTSRPCProxyHello:
		var (
			args []any
			rets []any
		)
		var (
			arg_msg string
		)
		args = []any{&arg_msg}
		if err := gotsrpc.LoadArgs(&args, callStats, r); err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		executionStart := time.Now()
		helloRet := p.service.Hello(r.Context(), arg_msg)
		callStats.Execution = time.Since(executionStart)
		rets = []any{helloRet}
		if err := gotsrpc.Reply(rets, callStats, r, w); err != nil {
			gotsrpc.ErrorCouldNotReply(w)
			return
		}
		gotsrpc.Monitor(w, r, args, rets, callStats)
		return
	case ServiceGoTSRPCProxyJoinedError:
		var (
			args []any
			rets []any
		)
		var (
			arg_msg string
		)
		args = []any{&arg_msg}
		if err := gotsrpc.LoadArgs(&args, callStats, r); err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		executionStart := time.Now()
		joinedErrorRet := p.service.JoinedError(r.Context(), arg_msg)
		callStats.Execution = time.Since(executionStart)
		rets = []any{joinedErrorRet}
		if err := gotsrpc.Reply(rets, callStats, r, w); err != nil {
			gotsrpc.ErrorCouldNotReply(w)
			return
		}
		gotsrpc.Monitor(w, r, args, rets, callStats)
		return
	case ServiceGoTSRPCProxyPkgError:
		var (
			args []any
			rets []any
		)
		var (
			arg_msg string
		)
		args = []any{&arg_msg}
		if err := gotsrpc.LoadArgs(&args, callStats, r); err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		executionStart := time.Now()
		pkgErrorRet := p.service.PkgError(r.Context(), arg_msg)
		callStats.Execution = time.Since(executionStart)
		rets = []any{pkgErrorRet}
		if err := gotsrpc.Reply(rets, callStats, r, w); err != nil {
			gotsrpc.ErrorCouldNotReply(w)
			return
		}
		gotsrpc.Monitor(w, r, args, rets, callStats)
		return
	case ServiceGoTSRPCProxyWrappedError:
		var (
			args []any
			rets []any
		)
		var (
			arg_msg string
		)
		args = []any{&arg_msg}
		if err := gotsrpc.LoadArgs(&args, callStats, r); err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		executionStart := time.Now()
		wrappedErrorRet := p.service.WrappedError(r.Context(), arg_msg)
		callStats.Execution = time.Since(executionStart)
		rets = []any{wrappedErrorRet}
		if err := gotsrpc.Reply(rets, callStats, r, w); err != nil {
			gotsrpc.ErrorCouldNotReply(w)
			return
		}
		gotsrpc.Monitor(w, r, args, rets, callStats)
		return
	default:
		gotsrpc.ClearStats(r)
		gotsrpc.ErrorFuncNotFound(w)
	}
}
